<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR Intelligence | Web3 Portal</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body class="not-logged-in">

    <div id="login-screen-wrapper">
        <div id="login-illustration">
            <div class="illustration-text">
                <h1>Welcome to the Future of HR.</h1>
                <p>Efficiently manage your workforce, gain insights, and empower your team with our AI-powered portal.</p>
            </div>
        </div>

        <div id="login-form-container">
            <div class="login-card">
                <h2 id="authTitle">HR Portal Login</h2>
                
                <div id="authError" class="login-error" style="display:none;">Error message</div>
                <div id="authSuccess" class="login-success" style="display:none;">Success message</div>

                <form id="loginForm" onsubmit="handleLogin(event)">
                    <div class="form-group" style="text-align: left;">
                        <label for="username">Username</label>
                        <input type="text" id="username" placeholder="Enter username" required>
                    </div>
                    <div class="form-group" style="text-align: left;">
                        <label for="password">Password</label>
                        <input type="password" id="password" placeholder="Enter password" required>
                    </div>
                    <button type="submit" class="btn">Sign In</button> 
                    <p class="auth-toggle">
                        Don't have an account? <span onclick="toggleAuthMode()">Create one</span>
                    </p>
                </form>

                <form id="signupForm" onsubmit="handleSignup(event)" style="display: none;">
                    <div class="form-group" style="text-align: left;">
                        <label for="newUsername">Choose Username</label>
                        <input type="text" id="newUsername" placeholder="New username" required>
                    </div>
                    <div class="form-group" style="text-align: left;">
                        <label for="newPassword">Choose Password</label>
                        <input type="password" id="newPassword" placeholder="New password" required>
                    </div>
                    <div class="form-group" style="text-align: left;">
                        <label for="confirmPassword">Confirm Password</label>
                        <input type="password" id="confirmPassword" placeholder="Retype password" required>
                    </div>
                    <button type="submit" class="btn">Create Account</button>
                    <p class="auth-toggle">
                        Already have an account? <span onclick="toggleAuthMode()">Back to Login</span>
                    </p>
                </form>
            </div>
        </div>
    </div>

    <nav class="top-nav">
        <div class="nav-links">
            <button class="tab active" data-tab="info">System Info</button>
            <button class="tab" data-tab="upload">Upload File</button>
            <button class="tab" data-tab="process">Process Data</button>
            <button class="tab" data-tab="push">Update Index</button>
            <button class="tab" data-tab="index-info">Index Status</button>
            <button class="tab" data-tab="search">Search Docs</button>
            <button class="tab" data-tab="answer">Ask AI Assistant</button>
        </div>
        <button class="tab logout-btn" onclick="handleLogout()">
            Log Out
        </button>
    </nav>

    <div class="container">
        <div class="header">
            <h1>HR Document Intelligence</h1>
            <p>Employee records, policy search, and automated assistance</p>
        </div>

        <div class="project-id-section">
            <label for="globalProjectId" style="margin:0;">Active Project ID:</label>
            <input type="text" id="globalProjectId" value="2" style="width: 150px;" placeholder="ID">
        </div>

        <div class="tab-content active" id="info">
            <h2>System Status</h2>
            <p style="margin-bottom: 15px; color: var(--text-muted);">View the current connectivity and health status of the RAG engine.</p>
            <button class="btn" onclick="getSystemInfo()">Check Status</button>
            <div class="loading" id="info-loading"><div class="spinner"></div><p>Connecting to server...</p></div>
            <div class="response" id="info-response"></div>
        </div>

        <div class="tab-content" id="upload">
            <h2>Upload Document</h2>
            <p style="margin-bottom: 20px; color: var(--text-muted);">Upload PDF policies, employee handbooks, or resumes.</p>
            
            <form onsubmit="uploadFile(event)">
                <div class="upload-container">
                    <div class="file-drop-area">
                        <input type="file" id="fileUpload" onchange="updateFileName(this)" required>
                        <div class="drop-content">
                            <svg class="upload-icon" xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21.2 15c.7-1.2 1-2.5 1-3.9 0-3.9-3.1-7-7-7-2.4 0-4.5 1.2-5.7 3.1C9.1 7 8.6 7 8.1 7 5.3 7 3 9.3 3 12.1c0 2.2 1.4 4.1 3.4 4.7"/>
                                <polyline points="16 10 12 6 8 10"/>
                                <line x1="12" y1="6" x2="12" y2="18"/>
                            </svg>
                            
                            <h3>Choose a file or drag & drop it here</h3>
                            <p class="file-limits">JPEG, PNG, PDF, and MP4 formats, up to 50 MB.</p>
                            
                            <span class="browse-pill-btn">Browse File</span>
                        </div>
                    </div>
                    <div id="fileName" class="selected-file-display"></div>
                </div>
                <button type="submit" class="btn" style="margin-top: 25px;">Upload Document</button>
            </form>
            
            <div class="loading" id="upload-loading"><div class="spinner"></div><p>Uploading file...</p></div>
            <div class="response" id="upload-response"></div>
        </div>

        <div class="tab-content" id="process">
            <h2>Process Data</h2>
            <p style="margin-bottom: 15px; color: var(--text-muted);">Prepare documents for the AI engine by chunking text.</p>
            <form onsubmit="processFiles(event)">
                <div class="form-group">
                    <label for="fileId">File ID (Optional):</label>
                    <input type="text" id="fileId" placeholder="Leave empty to process all pending files">
                </div>
                <div class="grid-2">
                    <div class="form-group">
                        <label for="chunkSize">Chunk Size (Tokens):</label>
                        <input type="number" id="chunkSize" value="1000" required>
                    </div>
                    <div class="form-group">
                        <label for="overlapSize">Overlap Size:</label>
                        <input type="number" id="overlapSize" value="200" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="doReset">Processing Mode:</label>
                    <select id="doReset">
                        <option value="0">Append (Keep existing data)</option>
                        <option value="1">Reset (Delete and re-process)</option>
                    </select>
                </div>
                <button type="submit" class="btn">Start Processing</button>
            </form>
            <div class="loading" id="process-loading"><div class="spinner"></div><p>Processing documents...</p></div>
            <div class="response" id="process-response"></div>
        </div>

        <div class="tab-content" id="push">
            <h2>Update Search Index</h2>
            <p style="margin-bottom: 15px; color: var(--text-muted);">Commit processed data to the vector database for retrieval.</p>
            <form onsubmit="pushToIndex(event)">
                <div class="form-group">
                    <label for="pushReset">Indexing Mode:</label>
                    <select id="pushReset">
                        <option value="0">Incremental Update</option>
                        <option value="1">Full Re-Index (Clear existing)</option>
                    </select>
                </div>
                <button type="submit" class="btn">Update Index</button>
            </form>
            <div class="loading" id="push-loading"><div class="spinner"></div><p>Updating index...</p></div>
            <div class="response" id="push-response"></div>
        </div>

        <div class="tab-content" id="index-info">
            <h2>Index Statistics</h2>
            <p style="margin-bottom: 15px; color: var(--text-muted);">View vector count and database health statistics.</p>
            <button class="btn" onclick="getIndexInfo()">Refresh Stats</button>
            <div class="loading" id="index-info-loading"><div class="spinner"></div><p>Fetching statistics...</p></div>
            <div class="response" id="index-info-response"></div>
        </div>

        <div class="tab-content" id="search">
            <h2>Document Search</h2>
            <p style="margin-bottom: 15px; color: var(--text-muted);">Find specific clauses or sections within uploaded documents.</p>
            <form onsubmit="searchIndex(event)">
                <div class="form-group">
                    <label for="searchText">Search Query:</label>
                    <input type="text" id="searchText" placeholder="e.g., 'Maternity leave policy details'" required>
                </div>
                <div class="form-group">
                    <label for="searchLimit">Results to Retrieve:</label>
                    <input type="number" id="searchLimit" value="5" min="1" max="20" required>
                </div>
                <button type="submit" class="btn">Search</button>
            </form>
            <div class="loading" id="search-loading"><div class="spinner"></div><p>Searching database...</p></div>
            <div class="response" id="search-response"></div>
        </div>

        <div class="tab-content" id="answer">
            <h2>Ask AI Assistant</h2>
            <p style="margin-bottom: 15px; color: var(--text-muted);">Generate answers to questions based on your knowledge base.</p>
            <form onsubmit="askQuestion(event)">
                <div class="form-group">
                    <label for="questionText">Your Question:</label>
                    <textarea id="questionText" placeholder="e.g., 'What is the procedure for filing a grievance?'" required></textarea>
                </div>
                <div class="form-group">
                    <label for="answerLimit">Reference Segments:</label>
                    <input type="number" id="answerLimit" value="5" min="1" max="20" required>
                </div>
                <button type="submit" class="btn">Generate Answer</button>
            </form>
            <div class="loading" id="answer-loading"><div class="spinner"></div><p>Analyzing and generating response...</p></div>
            <div class="response" id="answer-response"></div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>